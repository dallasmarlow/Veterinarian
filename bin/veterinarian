#!/usr/bin/env ruby

$:.unshift File.join File.dirname(__FILE__), *%w[.. lib]
require 'veterinarian'
vet = Veterinarian.new

################################################################################
# Notification: Initialize zookeeper client
require 'zknode'
vet.new_notify=ZkNode.new(connect_string=vet.config['ZkNode']['connect_string'],
                        parent_dir=vet.config['ZkNode']['parent_dir'],
                        logger=vet.log)

################################################################################
# Check: Initialize http check             
require 'httpcheck'
vet.new_check=HttpCheck.new( ip=vet.config['ip'], 
                            port=vet.config['HttpCheck']['port'], 
                            uri=vet.config['HttpCheck']['uri'], 
                            hostname=vet.config['hostname'], 
                            logger=vet.log)

################################################################################
# Start veterinarian
vet.start
